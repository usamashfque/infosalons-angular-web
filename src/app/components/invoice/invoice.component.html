<form *ngIf="isFormSow" class="form" [formGroup]="invoiceForm" novalidate
    (ngSubmit)="save(invoiceForm.value, invoiceForm.valid,$event)">

    <div class="d-flex justify-content-between align-items-center">
        <div>
            <label for="invoiceNo">Invoice No</label>
            <div class="input-group mb-3 w-100">
                <span class="input-group-text" id="basic-addon1">#</span>
                <input type="text" class="form-control" placeholder="" formControlName="invoiceNo" required>
            </div>
            <div *ngIf="submitted && f['invoiceNo'].errors" class="invalid-feedback d-block">
                <div *ngIf="f['invoiceNo'].errors['required']">Invoice no is required</div>
                <div *ngIf="f['invoiceNo'].errors['max']">Invoice no is invalid </div>
            </div>
        </div>
        <div>
            <button [disabled]="isLoading" type="button" class="ms-3" mat-raised-button [routerLink]="['../invoices']">
                Back
            </button>
        </div>
    </div>

    <hr class="my-2">

    <div class="row justify-content-between">
        <div class="col-md-5">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <p class="m-0">From</p>
                </div>
                <div>
                    <button type="button" class="btn btn-link">Edit Business Profile</button>
                </div>
            </div>
            <div>
                <p class="m-0">Rameez Raja</p>
                <p class="m-0">Abc Test Suite</p>
                <p class="m-0">45633 Dubai</p>
                <p class="m-0">United Arab Emirates</p>
            </div>
            <div>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="m-0">To</p>
                    </div>
                    <div>
                        <button type="button" class="btn btn-link">New Client</button>
                    </div>
                </div>
                <div class="mb-3">
                    <input type="text" formControlName="clientName" class="form-control w-100"
                        placeholder="Enter Client Name"
                        [ngClass]="submitted ? (f['clientName'].errors?'is-invalid':'is-valid') :''" />
                    <div *ngIf="submitted && f['clientName'].errors" class="invalid-feedback d-block">
                        <div *ngIf="f['clientName'].errors['required']">Client name is required</div>
                        <div *ngIf="f['clientName'].errors['pattern']">Client name is invalid </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-md-4">
            <div class="mb-3">
                <label for="invoiceDate">Date</label>
                <input type="date" formControlName="invoiceDate" class="form-control w-100"
                    [ngClass]="submitted ? (f['invoiceDate'].errors?'is-invalid':'is-valid') :''" />
                <div *ngIf="submitted && f['invoiceDate'].errors" class="invalid-feedback d-block">
                    <div *ngIf="f['invoiceDate'].errors['required']">Invoice date is required</div>
                </div>
            </div>
            <div class="  mb-3">
                <label for="invoiceDue">Invoice Due</label>
                <select class="form-select" formControlName="invoiceDue" class="form-control w-100">
                    <option selected value="1">Due on Receipt</option>
                </select>
                <div *ngIf="submitted && f['invoiceDue'].errors" class="invalid-feedback d-block">
                    <div *ngIf="f['invoiceDue'].errors['required']">Invoice due is required</div>
                </div>
            </div>
            <div class="  mb-3">
                <label for="purchaseOrderNumber">Purchase Order Number</label>
                <input type="text" formControlName="purchaseOrderNumber" class="form-control w-100"
                    placeholder="Order Number"
                    [ngClass]="submitted ? (f['purchaseOrderNumber'].errors?'is-invalid':'is-valid') :''" />
                <div *ngIf="submitted && f['purchaseOrderNumber'].errors" class="invalid-feedback d-block">
                    <div *ngIf="f['purchaseOrderNumber'].errors['required']">Purchase order number is required</div>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-3">

    <table class="table mb-3" formArrayName="invoiceItems">
        <thead>
            <tr>
                <th colspan="4" class="w-50">Description</th>
                <th>Quantity</th>
                <th>Rate</th>
                <th>Amount</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let item of getControls(); let i=index" [formGroupName]="i">
                <td colspan="4">
                    <div class="  mb-3">
                        <textarea formControlName="description" class="form-control w-100"
                            placeholder="Enter Client Name"
                            [ngClass]="submitted ? (getControls()[i]['controls']['description'].errors?'is-invalid':'is-valid') :''">
                            </textarea>
                        <div *ngIf="submitted && getControls()[i]['controls']['description'].errors"
                            class="invalid-feedback d-block">
                            <div *ngIf="getControls()[i]['controls']['description'].errors['required']">Item
                                description
                                is required</div>
                            <div *ngIf="getControls()[i]['controls']['description'].errors['max']">description
                                is invalid </div>
                        </div>

                        <div class="d-flex justify-content-between mt-2">
                            <div>
                                <i class="fas fa-2x fa-solid fa-file pe-3"></i>
                                <i class="fas fa-2x fa-solid fa-calendar-day"></i>
                                <i class="fas fa-2x fa-solid fa-link px-3"></i>
                                <i class="fas fa-2x fa-solid fa-tag"></i>
                            </div>
                            <div>
                                <i class="fas fa-2x fa-solid fa-dolly"></i>
                                <i class="fas fa-2x fa-solid fa-tag px-3"></i>
                                <i class="fas fa-2x fa-solid fa-box"></i>
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="  mb-3">
                        <input (keypress)="quantityFilter($event)" type="text" formControlName="quantity"
                            class="form-control w-100" placeholder="Quantity"
                            [ngClass]="submitted ? (getControls()[i]['controls']['quantity'].errors?'is-invalid':'is-valid') :''" />
                        <div *ngIf="submitted && getControls()[i]['controls']['quantity'].errors"
                            class="invalid-feedback d-block">
                            <div *ngIf="getControls()[i]['controls']['quantity'].errors['required']">Item quantity
                                is
                                required</div>
                            <div *ngIf="getControls()[i]['controls']['quantity'].errors['pattern']">Item quantity is
                                invalid </div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="  mb-3">
                        <input mask="separator.2" type="text" formControlName="rate" class="form-control w-100"
                            placeholder=""
                            [ngClass]="submitted ? (getControls()[i]['controls']['rate'].errors?'is-invalid':'is-valid') :''" />
                        <div *ngIf="submitted && getControls()[i]['controls']['rate'].errors"
                            class="invalid-feedback d-block">
                            <div *ngIf="getControls()[i]['controls']['rate'].errors['required']">
                                Item price is required
                            </div>
                            <div *ngIf="getControls()[i]['controls']['rate'].errors['pattern']">
                                Item price is invalid
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="  mb-3">
                        <input type="text" formControlName="itemTotalPrice" class="form-control w-100" />
                    </div>
                </td>
                <td>
                    <button [disabled]="isLoading" type="button" class="btn btn-danger" *ngIf="getControls().length > 1"
                        (click)="removeItem(i)">
                        Remove
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="row">
        <div class="col-md-4">
            <button type="button" class="btn btn-secondary" (click)="addItem()" [disabled]="isLoading">
                New Line
            </button>
        </div>
        <div class="col-md-8">
            <div class="d-flex px-2">
                <div class="flex-grow-1"> Sub Total</div>
                <div class="flex-shrink-1">
                    {{ invoiceForm.value.totalAmount | currency:'USD':'symbol-narrow':'1.2-2'}}
                </div>
            </div>
            <div class="d-flex my-2 px-2">
                <div class="flex-grow-1"> Total (USD)</div>
                <div class="flex-shrink-1"> {{ invoiceForm.value.totalAmount |
                    currency:'USD':'symbol-narrow':'1.2-2'}}</div>
            </div>
            <div class="d-flex justify-content-between border border-3 border-secondary rounded">
                <div class="bg-secondary flex-grow-0 p-2"> Balance </div>
                <div class="d-flex flex-grow-1 justify-content-between align-items-center px-2">
                    <div>USD</div>
                    <div>{{ invoiceForm.value.totalAmount |
                        currency:'USD':'symbol-narrow':'1.2-2'}}</div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <label for="defaultNote">Invoice Note (<button type="button" class="btn btn-link p-0">Default
                Notes</button>)</label>
        <textarea formControlName="defaultNote" class="form-control w-100" placeholder="Enter Client Name"
            [ngClass]="submitted ? (f['defaultNote'].errors?'is-invalid':'is-valid') :''">
            </textarea>
        <div *ngIf="submitted && f['defaultNote'].errors" class="invalid-feedback d-block">
            <div *ngIf="f['defaultNote'].errors['required']">Invoice Note is required</div>
            <div *ngIf="f['defaultNote'].errors['max']">defaultNote is invalid </div>
        </div>
    </div>

    <hr class="my-3">

    <div class="d-flex align-items-center">
        <div class="flex-grow-1">Email: rameezrajaz@hotmail.com</div>
        <div class="flex-shrink-1">
            <button class="btn btn-success px-3" type="submit" [disabled]="isLoading">
                {{isFormEdit?'Update Invoice':'Save Invoice'}}
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status"
                    aria-hidden="true"></span>
            </button>
        </div>
    </div>
</form>
<div class="bg-white py-5 text-center" *ngIf="!isFormSow">
    <div class="spinner-border text-dark" style="width: 3rem; height: 3rem;" role="status">
    </div>
</div>